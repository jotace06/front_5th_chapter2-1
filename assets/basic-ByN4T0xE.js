import"./modulepreload-polyfill-B5Qt9EMX.js";const H=({products:t,selectedId:e})=>t.map(n=>`<option 
          value="${n.id}" 
          ${n.stock===0?"disabled":""} 
          ${n.id===e?"selected":""}
        >${n.name} - ${n.price}원</option>`).join(""),b=t=>t.stock>0,E=(t,e)=>t.stock>=e,m=t=>t.id,B=t=>t.name,g=t=>t.stock,x=t=>t.price,w=(t,e)=>({...t,price:e}),F=(t,e)=>({...t,stock:Math.max(0,t.stock+e)}),Q=5,P=(t,e)=>t.find(n=>m(n)===e),y=(t,e,n)=>{if(n===0)return t;const o=P(t,e);if(!o)throw new Error("상품을 찾을 수 없습니다.");if(n<0&&!E(o,Math.abs(n)))throw new Error("재고가 부족합니다.");return t.map(r=>m(r)===e?F(r,n):r)},j=(t,e=Q)=>t.filter(n=>g(n)<e),K=(t,e,n)=>t.map(o=>{if(e.includes(m(o))){const r=x(o),s=Math.round(r*(1-n));return w(o,s)}return o}),W=t=>j(t).map(n=>{const o=B(n),r=g(n);return`${o}: ${r>0?`재고 부족 (${r}개 남음)`:"품절"}`}).join(`
`),Y=t=>{const{products:e}=t;return W(e)},h=t=>`${H({products:t.products,selectedId:t.lastSelected})}`,I=t=>`${Y({products:t.products})}`,z=()=>{const t=document.getElementById("product-select");return(t==null?void 0:t.value)||null},G=(t,e=1)=>({id:t.id,name:t.name,price:t.price,quantity:e}),J=t=>t.quantity,V=t=>t.quantity<=0,k=t=>t.price*t.quantity,M=(t,e)=>({...t,quantity:Math.max(0,t.quantity+e)}),$=(t,e)=>t.find(n=>n.id===e),v=(t,e)=>t.findIndex(n=>n.id===e),X=t=>t.reduce((e,n)=>e+n.quantity,0),Z=t=>t.reduce((e,n)=>e+k(n),0),tt=t=>t.length===0,et=(t,e)=>{const n=v(t,e.id);return n>=0?t.map((o,r)=>r===n?M(o,e.quantity):o):[...t,e]},nt=(t,e,n)=>{const o=P(t,n);if(!o)throw new Error("상품을 찾을 수 없습니다");if(!b(o))throw new Error("재고가 부족합니다.");const r=G(o,1);return et(e,r)},R=(t,e)=>t.filter(n=>n.id!==e),ot=(t,e)=>{if(!$(t,e))throw new Error("장바구니에 해당 상품이 없습니다.");return R(t,e)},rt=(t,e,n)=>{const o=v(t,e),r=M(t[o],n);return V(r)?R(t,e):t.map((s,a)=>a===o?r:s)},N=(t,e,n,o)=>{if(o===0)return t;const r=$(t,n);if(!r)throw new Error("장바구니에 해당 상품이 없습니다.");if(o>0){const s=P(e,n);if(!s)throw new Error("상품을 찾을 수 없습니다.");if(!E(s,o))throw new Error("재고가 부족합니다.")}if(o<0&&r.quantity<Math.abs(o))throw new Error("장바구니에 담긴 상품 수량이 부족합니다.");return rt(t,n,o)},ct={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25},st=30,T=.25,S=.1,at=1e3,ut=t=>J(t)<10?0:ct[t.id]||0,dt=t=>{const e=Z(t),n=X(t);let o=0;return t.forEach(r=>{const s=k(r),a=ut(r);o+=s*(1-a)}),{subtotal:e,discountedTotal:o,totalItems:n}},it=t=>t>=st,lt=t=>t.getDay()===2,mt=t=>Math.floor(t/at),p=(t,e=new Date)=>{if(tt(t))return{subtotal:0,finalTotal:0,discountRate:0,bonusPoints:0};const{subtotal:n,discountedTotal:o,totalItems:r}=dt(t);let s=o,a=(n-o)/n;if(it(r)){const U=o*T,q=n-o;U>q&&(s=n*(1-T),a=T)}lt(e)&&S>a&&(s=n*(1-S),a=S);const i=mt(s);return{subtotal:n,finalTotal:Math.round(s),discountRate:a,bonusPoints:i}},pt=({cartItem:t})=>`
    <div id="${t.id}" class="flex justify-between items-center mb-2"><span class="cart-item-info" data-product-id="${t.id}">${t.name} - ${t.price}원 x ${t.quantity}</span><div class="cart-item-actions"><button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="-1">-</button><button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="1">+</button><button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t.id}">삭제</button></div></div>
  `,ft=({finalTotal:t,discountRate:e,bonusPoints:n})=>{const o=e>0?`<span class="text-green-500 ml-2">(${(e*100).toFixed(1)}% 할인 적용)</span>`:"",r=`<span id="loyalty-points" class="text-blue-500 ml-2">(포인트: ${n})</span>`;return`
      <div class="text-xl font-bold my-4">총액: ${t}원${o}${r}</div>
    `},yt=t=>t.cartItems.map(e=>pt({cartItem:e})).join(""),C=t=>{const e=p(t.cartItems);return ft({subtotal:e.subtotal,finalTotal:e.finalTotal,discountRate:e.discountRate,bonusPoints:t.bonusPoints})},Tt=(t,e)=>{const n=t.cartItems.find(r=>r.id===e);if(!n)return;const o=document.getElementById(e);if(o){const r=o.querySelector("span");r&&(r.textContent=`${n.name} - ${n.price}원 x ${n.quantity}`)}},c={container:null,cartItems:null,cartTotal:null,productSelect:null,stockStatus:null,addButton:null};let u=null;const St=(t,e,n)=>{t&&(c.container=t,u=n,bt(),Pt(),D(e))},bt=()=>{if(!c.container)return;const t=document.createElement("div");t.className="bg-gray-100 p-8";const e=document.createElement("div");e.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8";const n=document.createElement("h1");n.className="text-2xl font-bold mb-4",n.textContent="장바구니";const o=document.createElement("div");o.id="cart-items",c.cartItems=o;const r=document.createElement("div");r.id="cart-total",r.className="text-xl font-bold my-4",c.cartTotal=r;const s=document.createElement("select");s.id="product-select",s.className="border rounded p-2 mr-2",c.productSelect=s;const a=document.createElement("button");a.id="add-to-cart",a.className="bg-blue-500 text-white px-4 py-2 rounded",a.textContent="추가",c.addButton=a;const i=document.createElement("div");i.id="stock-status",i.className="text-sm text-gray-500 mt-2",c.stockStatus=i,e.appendChild(n),e.appendChild(o),e.appendChild(r),e.appendChild(s),e.appendChild(a),e.appendChild(i),t.appendChild(e),c.container.appendChild(t)},Pt=()=>{!u||!c.container||c.container.addEventListener("click",t=>{const e=t.target;if(e.id==="add-to-cart"){const n=z();n&&(u==null||u.onAddToCart(n))}if(e.classList.contains("quantity-change")){const n=e.dataset.productId,o=parseInt(e.dataset.change||"0");n&&!isNaN(o)&&(u==null||u.onUpdateQuantity(n,o))}if(e.classList.contains("remove-item")){const n=e.dataset.productId;n&&(u==null||u.onRemoveItem(n))}})},D=(t,e)=>{if(!(!c.cartItems||!c.cartTotal||!c.productSelect||!c.addButton||!c.stockStatus)){if(e!=null&&e.partialUpdate&&e.targetId){Tt(t,e.targetId),c.cartTotal.innerHTML=C(t),c.productSelect.innerHTML=h(t),c.stockStatus.innerHTML=I(t);return}c.cartItems.innerHTML=yt(t),c.cartTotal.innerHTML=C(t),c.productSelect.innerHTML=h(t),c.stockStatus.innerHTML=I(t)}},_=(t,e,n,o)=>{if(!c.container&&t){St(t,e,n);return}D(e,o)},L=()=>({products:[{id:"p1",name:"상품1",price:1e4,stock:50},{id:"p2",name:"상품2",price:2e4,stock:30},{id:"p3",name:"상품3",price:3e4,stock:20},{id:"p4",name:"상품4",price:15e3,stock:0},{id:"p5",name:"상품5",price:25e3,stock:10}],cartItems:[],lastSelected:null,bonusPoints:0}),ht=(t,e)=>{try{const n=nt(t.products,t.cartItems,e),o=y(t.products,e,-1),r=p(n);return{...t,products:o,cartItems:n,lastSelected:e,bonusPoints:r.bonusPoints}}catch(n){return alert(n.message),t}},It=(t,e)=>{try{const n=N(t.cartItems,t.products,e,1),o=y(t.products,e,-1),r=p(n);return{...t,products:o,cartItems:n,bonusPoints:r.bonusPoints}}catch(n){return alert(n.message),t}},Ct=(t,e)=>{try{const n=N(t.cartItems,t.products,e,-1),o=y(t.products,e,1),r=p(n);return{...t,products:o,cartItems:n,bonusPoints:r.bonusPoints}}catch(n){return alert(n.message),t}},Et=(t,e)=>{try{const n=ot(t.cartItems,e),o=y(t.products,e,1),r=p(n);return{...t,products:o,cartItems:n,bonusPoints:r.bonusPoints}}catch(n){return alert(n.message),t}},A=.2,gt=t=>{const e=t.filter(o=>b(o));if(e.length===0)return;const n=Math.floor(Math.random()*e.length);return e[n]},xt=(t,e)=>K(t,[e],A),wt=(t,e)=>{const n=t.filter(r=>m(r)!==e&&b(r));if(n.length===0)return;const o=Math.floor(Math.random()*n.length);return n[o]},kt=(t,e)=>t.map(o=>{if(m(o)===e){const r=x(o),s=Math.round(r*(1-.05));return w(o,s)}return o}),Mt=t=>`번개세일! ${t}이(가) ${A*100}% 할인 중입니다!`,$t=t=>`${t}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`,vt=t=>{const e=gt(t.products);if(!e)return[t,null];const n=e.name,o=e.id,r=xt(t.products,o);return[{...t,products:r},Mt(n)]},Rt=t=>{if(!t.lastSelected)return[t,null];const e=wt(t.products,t.lastSelected);if(!e)return[t,null];const n=e.name,o=e.id,r=kt(t.products,o);return[{...t,products:r},$t(n)]};let d=L(),f=null;const l=(t,e)=>{d=t,_(f,d,O,e)},O={onAddToCart:t=>{l(ht(d,t))},onUpdateQuantity:(t,e)=>{e>0?l(It(d,t),{partialUpdate:!0,targetId:t}):e<0&&l(Ct(d,t))},onRemoveItem:t=>{l(Et(d,t))}};f||(f=document.getElementById("app"));d=L();_(f,d,O);const Nt=()=>{setTimeout(()=>{setInterval(()=>{if(Math.random()<.3){const[e,n]=vt(d);n&&(alert(n),l(e))}},3e4)},Math.random()*1e4),setTimeout(()=>{setInterval(()=>{if(d.lastSelected){const[t,e]=Rt(d);e&&(alert(e),l(t))}},6e4)},Math.random()*2e4)};Nt();
